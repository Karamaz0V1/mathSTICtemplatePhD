%%%%%%%%%%%%%%%%%
%%% main packages
%%%%%%%%%%%%%%%%%

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[euler]{textgreek}
\usepackage{lmodern}

\usepackage[french,english]{babel} %% last language is default (english here)

\usepackage{setspace} %% to increase spacing between lines
\usepackage{emptypage} %% to disable numbering on blank pages
\usepackage{xcolor} %% for the colors
\usepackage{geometry} %% for the margins
\usepackage{multicol} %% for the back matter
\usepackage{eso-pic} %% for the bacground pictures in front and back matters
%% \usepackahe{caption} %% highly recommended
%% \usepackage{subcaption} %% to have subfigures
\usepackage{minitoc} %% to have local toc in chapters, etoc package is also good, but a bit more complicated
\usepackage{tikz} %% for the placement of figures in front and back matters 
\usetikzlibrary{babel} %% here load more tikz libs if needed, babel is a compatibility lib for the babel package
\usepackage{tabularx} %% to have autoline break in front cover


%% We strongly recommend to use biblatex and biber for the bibliography
\usepackage[backend=biber,style=alphabetic,doi=false,isbn=false,hyperref=true,backref=true,maxbibnames=99,giveninits=true]{biblatex}
\usepackage{tocbibind}


%% to have pdf with clickable links
\usepackage[pdfusetitle,colorlinks=true]{hyperref}
%% to automatically prefix refs by the right label (figure, algorithm, etc.), must be called after hyperref, so at the end
%% to use it: \Cref{lbl:alabel}
\usepackage{cleveref}


%%%%%%%%%%%%%%%%%%%%%
%%% template MathSTIC
%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%% TITRE THESE PAGE DE GARDE %%%%%%%%%%%%%%%%

\makeatletter

% Logo ecole doctorale
\newcommand{\logoecoledoc}[1]{\gdef\@logoecoledoc{#1}}
\logoecoledoc{}

% Logo etablissement delivrant le diplome
\newcommand*{\logoetablissement}[1]{\gdef\@logoetablissement{#1}}
\logoetablissement{}

%%%% Titre en fran{\c c}ais
\newcommand{\setTitleFR}[1]{\gdef\@titleFR{#1}}
\setTitleFR{}
\newcommand{\getTitleFR}{\@titleFR}

%%%% Titre en anglais
\newcommand{\setTitleEN}[1]{\gdef\@titleEN{#1}}
\setTitleEN{}
\newcommand{\getTitleEN}{\@titleEN}

%%%% Eventuel sous-titre
\newcommand{\asubtitle}[1]{\gdef\@asubtitle{#1}}
\asubtitle{}

%%%% Discipline
\newcommand{\discipline}[1]{\gdef\@discipline{#1}}
\discipline{}

%%%% etablissement
\newcommand{\etablissement}[1]{\gdef\@etablissement{#1}}
\etablissement{}

%%%%% Ecole doctorale
\newcommand{\nbecoledoc}[1]{\gdef\@nbecoledoc{#1}}
\nbecoledoc{}

%%%%% Nom ecole
\newcommand{\nomecoledoc}[1]{\gdef\@nomecoledoc{#1}}
\nomecoledoc{}

%%%%% Sp\'{e}cialit\'{e}
\newcommand{\specialite}[1]{\gdef\@specialite{#1}}
\specialite{}

%%% Ville de soutenance
\newcommand{\lieu}[1]{\gdef\@lieu{#1}}
\lieu{}

%%% Unite de recherche
\newcommand{\uniterecherche}[1]{\gdef\@uniterecherche{#1}}
\uniterecherche{}

%%% Num{\'e}ro de la th{\`e}se
\newcommand{\numthese}[1]{\gdef\@numthese{#1}}
\numthese{}


%%% date
\newcommand{\datesoutenance}[1]{\gdef\@datesoutenance{#1}}
\datesoutenance{}

%%% lieu
\newcommand{\lieusoutenance}[1]{\gdef\@lieusoutenance{#1}}
\lieusoutenance{}

%%%%%%%%%% FONT SIZES


% Define commands to set fonts throughout the document
\newcommand*{\selectfontfrontcover}{\fontfamily{phv}\selectfont}  % Font style used in front cover 
\newcommand*{\selectfontbackcover}{\fontfamily{phv}\selectfont}   % Font style used in back cover 
\newcommand*{\selectfontchapheads}{\fontfamily{phv}\selectfont} % Font style used chapter headings


%%%%%%%%%%%%%%%% COULEURS RGB de l'ED%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\definecolor{grisfonce}{RGB}{49,49,49}
\definecolor{grisclair}{RGB}{111,111,111}
\definecolor{blanc}{RGB}{255,255,255}
\definecolor{mathSTIC-Color}{RGB}{233,90,104}


%%%%%%%%%%%%% LOGOS EN-TETES %%%%%%%%%%%%


\newcommand{\coverheader}[1]{%
\AddToShipoutPicture*{%
    \put(0,0){%
    \parbox[b][\paperheight]{\paperwidth}{%
        \includegraphics[width=\paperwidth,height=\paperheight,keepaspectratio]{#1}%
        \vfill
}}}
\thispagestyle{empty}
\clearpage
\begin{tikzpicture}[remember picture,overlay]

  %% check if path to logo has been set, adapted from
  %% https://tex.stackexchange.com/questions/53068/how-to-check-if-a-macro-value-is-empty-or-will-not-create-text-with-plain-tex-co
  {\if\relax\@logoecoledoc\relax
  %% if empty, do nothing
  \else
  %% if not empty, include logo
  \node[xshift=.1\paperwidth,yshift=0cm] {
  \includegraphics[width=5cm]{\@logoecoledoc}
  };
  \fi
  }
  
  \node[xshift=.6\paperwidth,yshift=0cm] {
  \includegraphics[width=5cm]{\@logoetablissement}
  };
\end{tikzpicture}
\par\nobreak
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% PREMIERE DE COUVERTURE %%%%%%

% Define some font sizes specific to the front cover
\newcommand{\HugeFront}{\fontsize{26}{31}\selectfont} % Used in 'these de doctorat' title
\newcommand{\LargeFront}{\fontsize{16}{19}\selectfont} % Used in thesis title
\newcommand{\JuryFontSize}{\fontsize{9.5}{11}\selectfont} % Used in tables for jury
%% LARGE, large, small of 12pt: 20.74pt, 14.4pt, 10.95pt
\newcommand{\LARGEtwelve}{\fontsize{20.74}{25}\selectfont} % original 12pt \LARGE
\newcommand{\largetwelve}{\fontsize{14.4}{17}\selectfont} % original 12pt \large
\newcommand{\normaltwelve}{\fontsize{12}{13.2}\selectfont} % original 12pt \normalsize
\newcommand{\smalltwelve}{\fontsize{11}{12.5}\selectfont} % original 12pt \small


%% adapted from:
%% https://tex.stackexchange.com/questions/360031/trying-to-create-dynamic-table-and-commands-alltogether
\gdef\@ReviewersContents{}
\newcommand{\AddReviewer}[2]{
\xdef\@ReviewersContents{\@ReviewersContents #1&#2\\}
}
\newcommand{\MakeReviewerTable}{
{\normaltwelve \textbf{Rapporteurs avant soutenance :}\par}
{\JuryFontSize 
\vspace{0.25cm}
\begin{tabularx}{\textwidth}{@{}p{0.3\textwidth}X}
\@ReviewersContents
\end{tabularx} \par
}}

\gdef\@JuryMembersContents{}
\newcommand{\AddRegularJuryMember}[3]{
\xdef\@JuryMembersContents{\@JuryMembersContents #1&#2&#3\\}
}
\newcommand{\MakeJuryMemberTable}{
{\normaltwelve \textbf{Composition du Jury :}\par}
{\JuryFontSize 
\vspace{0.25cm}
\begin{tabularx}{\textwidth}{@{}p{0.15\textwidth}p{0.3\textwidth}X}
\@JuryMembersContents
\end{tabularx} \par
}}

\gdef\@JuryInvitedContents{}
\newcommand{\AddInvitedJuryMember}[2]{
\xdef\@JuryInvitedContents{\@JuryInvitedContents #1&#2\\}
}
\newcommand{\MakeJuryInvitedTable}{
{\normaltwelve \textbf{Invit{\'e}(s) :}\par}
{\JuryFontSize 
\vspace{0.25cm}
\begin{tabularx}{\textwidth}{@{}p{0.3\textwidth}X}
\@JuryInvitedContents
\end{tabularx} \par
}}




%% remove indentation, adapted from
%% https://tex.stackexchange.com/questions/59245/how-to-disable-automatic-indent
\newlength\tindent
\setlength{\tindent}{\parindent}

%mise en page de la page de garde

\def\maketitle{%
\setlength{\parindent}{0pt}%
{\normaltwelve \selectfontfrontcover% Set font style for front cover page
% however we need sapcing env since we dont want that user settings modify the cover
\begin{spacing}{1}
        \vspace{3cm}
        {\HugeFront \textsc{Th{\`e}se de doctorat de} \par}
        \vspace{2cm}
        {\largetwelve \textsc{\@etablissement} \par}
        \vspace{0.5cm}
        {\smalltwelve \textsc{{\'E}cole Doctorale \No \@nbecoledoc} \par}
        {\normaltwelve \textit{\@nomecoledoc} \par}
        {\normaltwelve Sp{\'e}cialit{\'e} : \textit{\@specialite} \par}
        \vspace{0.5cm}
        \hspace{0.6cm}{\normaltwelve Par \par}
        \vspace{0.25cm}
        \hspace{0.6cm}{\LARGEtwelve \textbf{\@author} \par}
        \vspace{0.8cm}
        {\LargeFront \textbf{\@title} \par}
        \vspace{0.4cm}
        {\largetwelve \@asubtitle \par}
        \vspace{0.8cm}
        {\smalltwelve \textbf{Th{\`e}se pr{\'e}sent{\'e}e et soutenue {\`a} \@lieusoutenance, le \@datesoutenance} \par}
	{\smalltwelve \textbf{Unit{\'e} de recherche : \@uniterecherche} \par}
	{\smalltwelve \textbf{Th{\`e}se \No : \@numthese} \par}
        \vspace{1cm}
        \MakeReviewerTable
        \vspace{0.6cm}
        \MakeJuryMemberTable
        \vspace{0.6cm}
        \MakeJuryInvitedTable
\end{spacing}
}
\setlength{\parindent}{\tindent}
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%% QUATRIEME DE COUVERTURE %%%%%%%%%%%%%%%%

\newcommand{\abstractFR}[2]{%
\selectlanguage{french}
\selectfontbackcover\smalltwelve
\vspace{3.3cm}
{\centering \noindent \textcolor{mathSTIC-Color}{\rule{\textwidth}{0.2cm}}}
\vspace{-1cm}
\section*{\selectfontbackcover \textcolor{mathSTIC-Color}{\smalltwelve Titre~:~}{\normaltwelve\mdseries{\getTitleFR{}}}} % In this particular case, font style needs to get re-selected locally
\vspace{-0.2cm}
{\noindent \textbf{Mots-cl{\'e}s : }#1\par}
\vspace{-0.2cm}
\begin{multicols}{2}
\begin{spacing}{1}
{\smalltwelve
\noindent \textbf{R{\'e}sum{\'e}~:}~#2\par}
\end{spacing}
\end{multicols}
}

\newcommand{\abstractEN}[2]{%
\selectlanguage{english}
\selectfontbackcover\smalltwelve
\vspace{0.5cm}
{\centering \noindent \textcolor{mathSTIC-Color}{\rule{\textwidth}{0.2cm}}}
\vspace{-1cm}
\section*{\selectfontbackcover \textcolor{mathSTIC-Color}{\smalltwelve Title:~}{\normaltwelve\mdseries{\getTitleEN{}}}} % In this particular case, font style needs to get re-selected locally
\vspace{-0.2cm}
{\noindent \textbf{Keywords: }#1\par}
\vspace{-0.2cm}
\begin{multicols}{2}
\begin{spacing}{1}
{\smalltwelve
\noindent \textbf{Abstract:}~#2\par}
\end{spacing}
\end{multicols}
}


\makeatother



%%%%%%%%%%%%%%%%%%%%%%%
%%% other redefinitions
%%%%%%%%%%%%%%%%%%%%%%%


\newcommand*\cleartoleftpage{%
  \clearpage
  \ifodd\value{page}\hbox{}\pagestyle{empty}\newpage\fi
}
